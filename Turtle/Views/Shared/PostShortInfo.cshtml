@model Turtle.Models.Post

@section Styles {
    <link rel="stylesheet" href="~/css/posts.css" />
}

<div class="card-body">

    <!-- HEADER -->
    <div class="d-flex justify-content-between align-items-start mb-2">

        <div>
            <a asp-controller="Posts"
               asp-action="Show"
               asp-route-id="@Model.Id"
               asp-route-search="@Context.Request.Query["search"]"
               asp-route-tab="@Context.Request.Query["tab"]"
               asp-route-pageH="@Context.Request.Query["pageH"]"
               asp-route-pageR="@Context.Request.Query["pageR"]"
               class="text-decoration-none">

                <h4 class="turtle-post-title">
                    @Model.Title
                </h4>
            </a>
        </div>

        <!-- MENU -->
        <div class="dropdown">
            <i class="bi bi-three-dots-vertical option-hover no-arrow"
               id="postMenu-@Model.Id"
               data-bs-toggle="dropdown"
               style="cursor:pointer"></i>

            @if (ViewBag.CurrentUserId == Model.UserId || ViewBag.UserIsAdmin)
            {
                <ul class="dropdown-menu dropdown-menu-end"
                    aria-labelledby="postMenu-@Model.Id">

                    @if (ViewBag.CurrentUserId == Model.UserId)
                    {
                        <li>
                            <a class="dropdown-item text-info"
                               asp-controller="Posts"
                               asp-action="Edit"
                               asp-route-id="@Model.Id">
                                Edit
                            </a>
                        </li>
                    }

                    <li>
                        <form method="post"
                              asp-controller="Posts"
                              asp-action="Delete"
                              asp-route-id="@Model.Id"
                              asp-route-search="@Context.Request.Query["search"]"
                              asp-route-tab="@Context.Request.Query["tab"]"
                              asp-route-pageH="@Context.Request.Query["pageH"]"
                              asp-route-pageR="@Context.Request.Query["pageR"]">

                            <button class="dropdown-item text-danger">
                                Delete
                            </button>
                        </form>
                    </li>
                </ul>
            }
        </div>
    </div>

    <!-- CATEGORIES -->
    @if (Model.PostCategories.Any())
    {
        <div class="mb-2">
            @foreach (var postCat in Model.PostCategories)
            {
                <span class="badge bg-secondary me-1">
                    #@postCat.Category.CategoryName
                </span>
            }
        </div>
    }

    <!-- META -->
    <div class="d-flex flex-wrap gap-3 turtle-post-meta mb-2">
        <div>
            <a class="text-decoration-none text-reset" 
                asp-area="" asp-controller="Users" 
                asp-action="Show" 
                asp-route-id="@Model.UserId" >
            
                <i class="bi bi-person-circle"></i>
                @Model.User.UserName
            </a>
        </div>

        @if (Model.CommunityId != null)
        {
            <div>
                <i class="bi bi-building"></i>
                @Model.Community.CommunityName
            </div>
        }

        <div>
            <i class="bi bi-calendar"></i>
            @Model.CreatedAt
        </div>
    </div>

    <!-- CONTENT -->
    <div class="turtle-post-content mb-3">
        @Model.Content
    </div>

    <!-- FILES -->
    @if (Model.Files != null && Model.Files.Any())
    {
        <div class="turtle-post-files mb-3">
            <strong>Attachments:</strong>

            <ul class="list-unstyled mt-2">
                @foreach (var file in Model.Files)
                {
                    <li>
                        <i class="bi bi-paperclip"></i>
                        <a href="@file" target="_blank">
                            @System.IO.Path.GetFileName(file)
                        </a>
                    </li>
                }
            </ul>
        </div>
    }

    <!-- FOOTER -->
    <div class="turtle-post-footer">
        @if (Model.Liked)
        {
            <span class="text-success">
                <i class="bi bi-heart-fill"></i> @Model.Likes
            </span>
        }
        else
        {
            <span class="text-success">
                <i class="bi bi-heart"></i> @Model.Likes
            </span>
        }
    </div>

</div>
